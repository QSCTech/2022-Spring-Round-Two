# BackEnd-SMS

## 题目背景

----

在经历了qsc的一轮面试后，大家想必已经收到了qsc发出的各种短信，可以想见的是，我们不会一条条手动发送，作为一个技术人，我们当然已经将其写成了项目，进行自动批量发送。本题会将你带入当时开发这个项目时的环境，并给出部分指引，来帮助你感受项目开发的方方面面。

## 题目简介
----

实现短信息服务（SMS）

## 阅前须知
----

- 要求在github上建立项目，并建立文档
- 基于服务实现过程写一份Markdown学习报告，并附上项目地址
- 具体可见下文逻辑指引，如有任何疑问，请联系@烫立方
- 尽管本题是一个项目的小切片，但是体量仍然不可忽视，故我们并不会依照完成度给分，而是按照您在学习报告中表现的探索与努力给分

## 前置知识
----

- What is Git/Github
- What is Secure Shell(SSH)
- What is Markdown
- Any Language(Recommend Golang)
- Any DBMS(Recommend PostgreSQL)

## 参考文档
----

- [Git Documentation](https://git-scm.com/doc)

- [Git Tutorial](https://www.runoob.com/git/git-tutorial.html)

- [What is Secure Shell(SSH)](https://en.wikipedia.org/wiki/Secure_Shell)

- [Markdown Guide](https://www.markdownguide.org/basic-syntax/)

- [Markdown Tutorial](https://www.runoob.com/markdown/md-tutorial.html)

- [The Little Go Book](./TheLittleGoBook.pdf)

- [PostgreSQL Documentation](https://www.postgresql.org/docs/current/)

## 逻辑指引
----
那我们就要开始尝试构建SMS服务的大致流程了

首先，qsc当然没有能力搭一座信息基站，也没有体量直接与运营商沟通能不能让我们具有发短信的资格，所以，短信的实际发送其实是由一些公司来实现的，而我们只是将短信的内容通知公司而已。
![process](./process.jpg)
正如上图所示，Luosimao就是这样一家公司，我们想要发短信的需求会先从客户端发送到qsc的服务器中，然后再由SMS服务进行处理，发送给Luosimao服务器，再由它转交给运营商，最后才能发送到你们的手机中，真是一个漫长的旅行呢。

接下来就让我来介绍旅途中的各个站点吧

### 第一站 客户端

很抱歉的是，这个项目并没有前端，也就是说，没有GUI支持，那么怎么向我们的服务器发送需求呢？我们选择通过函数来实现。

    SMS项目提供一系列函数实现短信发送，其他项目开发者可以通过调用函数的方式来请求服务器提交短信发送申请。

看起来很简单，但这一系列函数的格式是由什么决定的呢？那当然是身为开发者的你啦，不过，你不能要求其他开发者来查你的源码来寻找你到底写了什么函数，调用方式与逻辑是什么，所以我们引入第一个文档**接口文档**

    接口文档定义了SMS项目提供给其他开发者的函数的：‘格式’，‘功能’

当然，功能是由产品给出的**需求文档**来决定的，我摘取了其中一部分
||功能需求|备注|
|:-:|:-:|:-:|
|短信添加|对不同类型短信进行命名||
|短信删除|删除‘已保存’或‘审核通过’短信模板|对于审核通过的短信：<br>若未确认发送则内容作废<br>若已完成发送则提醒是否新建短信重新提醒|
|短信审核|对‘已保存’的短信进行审核|完成审核后**一定时间**自动发送|
|短信排序|根据‘短信状态’‘短信名称’‘最近更新’进行排序<br>直观呈现给管理者短信的状态|默认状态为‘最近更新’‘降序排序’<br>排序方式‘降序’‘升序’‘复原’|
|短信搜索|输入关键词对短信进行搜索定位|执行搜索操作后，将短信按搜索相关度降序排序|

可是，其他开发者调用函数的方式是什么呢？我们最熟悉的当然是本地调用，就像c语言调用stdio.h库与python进行import一样，可是这种方式在现实中往往确实不现实的。其他项目可能会运行在A机器上，SMS项目可能会运行在B机器上，那么，是不是有什么办法让我们跨机器调用函数呢，答案就是**RPC框架**。（这里只作提醒，具体请自行了解）

### 第二站 数据库

到了这一站，我们要考虑需要调用者传入什么参数了，最好当然是短信内容，目标手机号，目标个人信息，面试时间等一应俱全，不过很明显，这也是不现实的，不然与调用者直接和公司交互有什么区别，还少了中间商赚差价。因此，我们希望让调用者提供尽量少的参数，例如**目标的唯一识别号**，**发送短信的模板编号**（这个在第四站会有解释），而通过这些不足以发送短信的信息与我们保存在本地的信息进行组合，我们就拥有了完整的信息了（大家在填写qsc报名表的时候会给出一部分个人信息，这些信息都被我们偷偷记在小本本上，用于信息的补全了）。

那么，保存在本地的信息肯定也有着它自己的组织方式，特定的查询、变动方式。没错，就是**DBMS**，有一种称为**SQL**的语言专门来干这事，但是，它太麻烦了！于是，语言一般都会有一些前人写好的库，使用更加优美的方式调用DBMS，这样就省得你再去学一门语言了。

数据库的基本操作就是‘增’、‘删’、‘改’、‘查’，但有一点比较麻烦，就是在建立的时候，要指明数据的各个属性见的关系（我们一般使用的都是关系型数据库），这里就涉及了第二个文档**数据文档**

    数据文档定义了数据库中数据的组织形式，如有哪些表、哪些参量、哪个是主键等

## 第三站 服务器

好，我们终于前进到了最核心的代码逻辑了！将短信模板与占位符（第四站由解释）的信息上交给公司就万事大吉了，诶，这样就结束了嘛？

当然不是啦，你看我们需求文档里的功能都还没有实现呢！而且，在给出接口函数后，同一时间可能有不止一个人尝试调用，如果按照我们常见的顺序结构编写代码，那么将会只能处理一个人的请求而忽略其他人，这当然是不行的，于是，我们可以通过**多线程**的方法，借影分身之术来实现同一时间内处理多个请求（具体请自行了解）

## 第四站 运营商

    短信是由模板与占位符组成的，占位符中需要填入可变信息，如姓名、面试时间等

正如我们给其他开发者接口函数一样，公司那边也会给我们接口函数，具体来说，Luosimao的接口就如[链接](https://luosimao.com/docs/api/)所示，这个公司因为安全问题，只支持我们进行两种短信发送：纯静态短信、具有可变内容的短信。这也是为何有上述短信定义了。

其实，短信模板都是保存在公司服务器上的，SMS项目通过不断的与其交互，给了其他开发者一个抽象：这是一个更方便的，与公司接口库等价的服务。那么，SMS是如何与其交互的呢？很明显，Luosimao并没有提供RPC调用服务，也不在我们本地，于是我们可以通过POST、GET等网络请求来进行交互（这也丰富第一站的调用方法），这里有另一套输入输出方式。（具体请自行了解）

## 尾声

短信的旅程到这里就结束了，接下来通过信息基站到达诸位手机的行程，已经不再本题的讨论范围之内了。

可是，项目的建立远没有结束，当你构建了完整的代码后，还有一批人（**运行维护组**），他们需要将你的程序部署在qsc的服务器上，使其真正的投入使用。

编写业务逻辑讲究的是正确性，而他们关心的是可能的错误，网络波动啦、数组越界啦、查询出错啦，他们当然也不会去研究那庞大的项目代码，可是他们还需要排除故障，于是就需要提出最后的两个文档：**函数文档**，**错误文档**。

    函数文档是你自定义的所有函数的格式与逻辑，方便定位出错点

这里同时也要求你在写代码的同时添加各种注释，力求你3年后会看这个项目，依然能够看懂自己写了什么

    错误文档包含了各个错误信息可能发生的位置与可能发生的原因，以及其可能的处理方式

这里同时也暗示了，你在执行阶段性任务成功后，要在日志里面输出成功信息，在某些可能出现错误的地方，要写错误处理，并在日志中有所输出体现。

## 任务清单
----

- 选择一个DBMS
    - 建立报名者信息表，面试信息表
    - 熟悉SQL操作
    - 熟悉所选语言提供的DBMS调用接口（
- 设计函数与接口
    - 提供给其他开发者调用的接口
    - 自定义函数的逻辑图
- 实现需求文档内的功能需求
    - 假设短信模板是在本地
- 基于[公司API实例](https://luosimao.com/docs/api/)，在本地复现其SDK架构
    - 其中关于账户信息的API不用复现
    - 熟悉所选语言对网络请求的处理模式
- 实现与运营商交互的逻辑
    - 要求：无需在公司页面上进行GUI操作
    - 登陆逻辑
    - 模板操作逻辑
    - 个人信息逻辑不要求
- 实现可能的错误处理逻辑
- 基于RPC重构提供函数
- 编写文档
    - 及文中提到的四个文档

## 总结反思
----

你或许可以同我们探讨一下（在学习文档里）
- 你觉得解决这个任务的过程有意思吗？
- 你在网上找到了哪些资料供你学习？
- 你觉得去哪里/用什么方式搜索可以比较有效的获得自己想要的资料？
- 在过程中，你遇到最大的困难是什么？你是怎么解决的？

以上。